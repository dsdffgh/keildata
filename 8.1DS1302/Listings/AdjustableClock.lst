C51 COMPILER V9.60.7.0   ADJUSTABLECLOCK                                                   01/27/2023 12:30:58 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE ADJUSTABLECLOCK
OBJECT MODULE PLACED IN .\Objects\AdjustableClock.obj
COMPILER INVOKED BY: Z:\buyaobilian\keil_v5\C51\BIN\C51.EXE AdjustableClock.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEN
                    -D PRINT(.\Listings\AdjustableClock.lst) TABS(2) OBJECT(.\Objects\AdjustableClock.obj)

line level    source

   1          #include <REGX52.H>
   2          #include "LCD1602.h"
   3          #include "DS1302.h"
   4          #include "Delay.h"
   5          #include "MatrixKey.h"
   6          #include "Timer0.h"
   7          
   8          unsigned char KeyNum, ClockMode;
   9          unsigned char TimeSelect; // 时钟设置位选择
  10          unsigned char TimeCal_FlashFlag;
  11          unsigned char i = 0;
  12          
  13          void Time_Cross_Judgment()
  14          {
  15   1          *DS1302_Time %= 99;
  16   1          if (DS1302_Time[1] >= 13)
  17   1          {
  18   2              DS1302_Time[1] = 1;
  19   2          }
  20   1          else if (DS1302_Time[1] < 1)
  21   1          {
  22   2              DS1302_Time[1] = 12;
  23   2          }
  24   1          if (DS1302_Time[1] == 2) // 闰月
  25   1          {
  26   2              if (*DS1302_Time % 4 == 0) // 年份范围是2000-2099，不必判断整百年
  27   2              {
  28   3                  if (DS1302_Time[2] > 29)
  29   3                  {
  30   4                      DS1302_Time[2] = 1;
  31   4                  }
  32   3                  if (DS1302_Time[2] < 1)
  33   3                  {
  34   4                      DS1302_Time[2] = 29;
  35   4                  }
  36   3              }
  37   2              else
  38   2              {
  39   3                  if (DS1302_Time[2] > 28)
  40   3                  {
  41   4                      DS1302_Time[2] = 1;
  42   4                  }
  43   3                  if (DS1302_Time[2] < 1)
  44   3                  {
  45   4                      DS1302_Time[2] = 28;
  46   4                  }
  47   3              }
  48   2          }
  49   1          else if (DS1302_Time[1] == 4 || DS1302_Time[1] == 9 || DS1302_Time[1] == 6 || DS1302_Time[1] == 11)
  50   1          {
  51   2              if (DS1302_Time[2] > 30)
  52   2              {
  53   3                  DS1302_Time[2] = 1;
  54   3              }
C51 COMPILER V9.60.7.0   ADJUSTABLECLOCK                                                   01/27/2023 12:30:58 PAGE 2   

  55   2              if (DS1302_Time[2] < 1)
  56   2              {
  57   3                  DS1302_Time[2] = 30;
  58   3              }
  59   2          }
  60   1          else
  61   1          {
  62   2      
  63   2              if (DS1302_Time[2] > 31)
  64   2              {
  65   3                  DS1302_Time[2] = 1;
  66   3              }
  67   2              if (DS1302_Time[2] < 1)
  68   2              {
  69   3                  DS1302_Time[2] = 31;
  70   3              }
  71   2          }
  72   1          DS1302_Time[3] %= 24;
  73   1          if (DS1302_Time[3] < 0)
  74   1          {
  75   2              DS1302_Time[3] = 23;
  76   2          }
  77   1          DS1302_Time[4] %= 60;
  78   1          if (DS1302_Time[4] < 0)
  79   1          {
  80   2              DS1302_Time[4] = 59;
  81   2          }
  82   1          DS1302_Time[5] %= 60;
  83   1          if (DS1302_Time[5] < 0)
  84   1          {
  85   2              DS1302_Time[5] = 59;
  86   2          }
  87   1      
  88   1          if (DS1302_Time[1] > 7)
  89   1          {
  90   2              DS1302_Time[1] = 1;
  91   2          }
  92   1      }
  93          
  94          void TimeShow()
  95          {
  96   1          LCD_ShowNum(1, 1, DS1302_Time[0], 2);
  97   1          LCD_ShowNum(1, 4, DS1302_Time[1], 2);
  98   1          LCD_ShowNum(1, 7, DS1302_Time[2], 2);
  99   1          LCD_ShowNum(2, 1, DS1302_Time[3], 2);
 100   1          LCD_ShowNum(2, 4, DS1302_Time[4], 2);
 101   1          LCD_ShowNum(2, 7, DS1302_Time[5], 2);
 102   1      }
 103          
 104          void TimeCalibrating()
 105          {
 106   1          if (KeyNum == 2)
 107   1          {
 108   2              TimeSelect++;
 109   2              TimeSelect %= 6; // 超过 5 自动清零
 110   2              //LCD_ShowNum(2, 10, TimeSelect, 2);
 111   2          }
 112   1          if (KeyNum == 3)
 113   1          {
 114   2              DS1302_Time[TimeSelect]++;
 115   2          }
 116   1          else if (KeyNum == 4)
C51 COMPILER V9.60.7.0   ADJUSTABLECLOCK                                                   01/27/2023 12:30:58 PAGE 3   

 117   1          {
 118   2              DS1302_Time[TimeSelect]--;
 119   2          }
 120   1          Time_Cross_Judgment();
 121   1      
 122   1        if (TimeSelect == 0 && TimeCal_FlashFlag == 1){LCD_ShowString(1, 1, "  ");}else{LCD_ShowNum(1, 1, DS1302_
             -Time[0], 2);}
 123   1        if (TimeSelect == 1 && TimeCal_FlashFlag == 1){LCD_ShowString(1, 4, "  ");}else{LCD_ShowNum(1, 4, DS1302_
             -Time[1], 2);}
 124   1        if (TimeSelect == 2 && TimeCal_FlashFlag == 1){LCD_ShowString(1, 7, "  ");}else{LCD_ShowNum(1, 7, DS1302_
             -Time[2], 2);}
 125   1        if (TimeSelect == 3 && TimeCal_FlashFlag == 1){LCD_ShowString(2, 1, "  ");}else{LCD_ShowNum(2, 1, DS1302_
             -Time[3], 2);}
 126   1        if (TimeSelect == 4 && TimeCal_FlashFlag == 1){LCD_ShowString(2, 4, "  ");}else{LCD_ShowNum(2, 4, DS1302_
             -Time[4], 2);}
 127   1        if (TimeSelect == 5 && TimeCal_FlashFlag == 1){LCD_ShowString(2, 7, "  ");}else{LCD_ShowNum(2, 7, DS1302_
             -Time[5], 2);}
 128   1      
 129   1          //LCD_ShowNum(2, 13, TimeCal_FlashFlag, 2);
 130   1          DS1302_SetTime();
 131   1      }
 132          
 133          
 134          void Timer0_Rountine() interrupt 1 // 中断子程序
 135          {
 136   1          static unsigned int T0Count;
 137   1          TMOD &= 0xF0;
 138   1          TMOD |= 0x01;
 139   1          T0Count++;
 140   1          if (T0Count >= 13)
 141   1          {
 142   2              T0Count = 0;
 143   2              TimeCal_FlashFlag = !TimeCal_FlashFlag;
 144   2          }
 145   1      }
 146          
 147          void main()
 148          {
 149   1          LCD_Init();
 150   1          DS1302_Init();
 151   1          Timer0Init();
 152   1      
 153   1          DS1302_SetTime();
 154   1          while (1)
 155   1          {
 156   2              KeyNum = MatrixKey();
 157   2              if (KeyNum == 1)
 158   2              {
 159   3                  ClockMode = ~ClockMode;
 160   3              }
 161   2              if (ClockMode)
 162   2              {
 163   3                  TimeCalibrating();
 164   3              }
 165   2              else
 166   2              {
 167   3                  DS1302_ReadTime();
 168   3                  TimeShow();
 169   3              }
 170   2          }
 171   1      }

C51 COMPILER V9.60.7.0   ADJUSTABLECLOCK                                                   01/27/2023 12:30:58 PAGE 4   


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    761    ----
   CONSTANT SIZE    =      3    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      7    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
